---
// ===========================================
// EJEMPLO DE USO DE VARIABLES DE ENTORNO
// ===========================================
// Esta p√°gina demuestra c√≥mo usar variables de entorno en Astro

// IMPORTACI√ìN EN CLIENTE (Variables p√∫blicas) - Estas siempre estar√°n disponibles
import {
  PUBLIC_SITE_TITLE,
  PUBLIC_AUTHOR_NAME,
  PUBLIC_GITHUB_USERNAME,
  PUBLIC_DEBUG_MODE,
  PUBLIC_FORMSPREE_ENDPOINT,
} from 'astro:env/client';

import { Layout } from '@layouts';
import { SITE_CONFIG } from '@config/site.js';

// Funci√≥n helper para verificar si una variable del servidor est√° disponible
// const checkServerVariable = async (varName: string) => {
//   try {
//     const { getSecret } = await import('astro:env/server');
//     return !!getSecret(varName);
//   } catch {
//     return false;
//   }
// };

// Verificaciones de variables del servidor usando getSecret
let serverStatus = {
  hasFormspree: false,
  hasWebhook: false,
  hasAnalytics: false,
  timestamp: new Date().toISOString(),
};

try {
  const { getSecret } = await import('astro:env/server');
  serverStatus = {
    hasFormspree: !!PUBLIC_FORMSPREE_ENDPOINT,
    hasWebhook: !!getSecret('WEBHOOK_URL'),
    hasAnalytics: !!getSecret('ANALYTICS_API_KEY'),
    timestamp: new Date().toISOString(),
  };
} catch (error) {
  console.log('Variables del servidor no disponibles en modo est√°tico');
}

const pageTitle = `${PUBLIC_SITE_TITLE} - Variables de Entorno`;
---

<Layout title={pageTitle}>
  <main class="max-w-4xl mx-auto py-8 px-4">
    <h1 class="text-3xl font-bold mb-8 text-center">
      üîß Variables de Entorno en Astro
    </h1>

    <!-- INFORMACI√ìN DEL SITIO -->
    <section class="mb-8 p-6 bg-blue-50 rounded-lg">
      <h2 class="text-2xl font-semibold mb-4">üìã Informaci√≥n del Sitio</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <strong>T√≠tulo:</strong>
          {PUBLIC_SITE_TITLE}
        </div>
        <div>
          <strong>Autor:</strong>
          {PUBLIC_AUTHOR_NAME}
        </div>
        <div>
          <strong>GitHub:</strong>
          {PUBLIC_GITHUB_USERNAME || 'No configurado'}
        </div>
        <div>
          <strong>Debug Mode:</strong>
          <span
            class={PUBLIC_DEBUG_MODE ? 'text-orange-600' : 'text-green-600'}
          >
            {PUBLIC_DEBUG_MODE ? 'Habilitado' : 'Deshabilitado'}
          </span>
        </div>
      </div>
    </section>

    <!-- CONFIGURACI√ìN DEL SERVIDOR -->
    <section class="mb-8 p-6 bg-green-50 rounded-lg">
      <h2 class="text-2xl font-semibold mb-4">üñ•Ô∏è Servicios del Servidor</h2>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <div class="text-center p-4 bg-white rounded-lg shadow">
          <div class="text-2xl mb-2">
            {serverStatus.hasFormspree ? '‚úÖ' : '‚ùå'}
          </div>
          <div class="font-medium">Formspree</div>
          <div class="text-sm text-gray-600">
            {serverStatus.hasFormspree ? 'Configurado' : 'No configurado'}
          </div>
        </div>

        <div class="text-center p-4 bg-white rounded-lg shadow">
          <div class="text-2xl mb-2">
            {serverStatus.hasWebhook ? '‚úÖ' : '‚ùå'}
          </div>
          <div class="font-medium">Webhook</div>
          <div class="text-sm text-gray-600">
            {serverStatus.hasWebhook ? 'Configurado' : 'No configurado'}
          </div>
        </div>

        <div class="text-center p-4 bg-white rounded-lg shadow">
          <div class="text-2xl mb-2">
            {serverStatus.hasAnalytics ? '‚úÖ' : '‚ùå'}
          </div>
          <div class="font-medium">Analytics</div>
          <div class="text-sm text-gray-600">
            {serverStatus.hasAnalytics ? 'Configurado' : 'No configurado'}
          </div>
        </div>
      </div>
    </section>

    <!-- CONFIGURACI√ìN DESDE SITE.JS -->
    <section class="mb-8 p-6 bg-purple-50 rounded-lg">
      <h2 class="text-2xl font-semibold mb-4">
        ‚öôÔ∏è Configuraci√≥n desde site.js
      </h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <div>
          <strong>URL del Sitio:</strong><br />
          <code class="text-sm bg-gray-100 px-2 py-1 rounded"
            >{SITE_CONFIG.url}</code
          >
        </div>
        <div>
          <strong>Versi√≥n:</strong><br />
          <code class="text-sm bg-gray-100 px-2 py-1 rounded"
            >{SITE_CONFIG.version}</code
          >
        </div>
        <div>
          <strong>Autor:</strong><br />
          <code class="text-sm bg-gray-100 px-2 py-1 rounded"
            >{SITE_CONFIG.author}</code
          >
        </div>
        <div>
          <strong>Debug:</strong><br />
          <code class="text-sm bg-gray-100 px-2 py-1 rounded"
            >{SITE_CONFIG.debug}</code
          >
        </div>
      </div>
    </section>

    <!-- INFORMACI√ìN T√âCNICA -->
    <section class="mb-8 p-6 bg-gray-50 rounded-lg">
      <h2 class="text-2xl font-semibold mb-4">üîç Informaci√≥n T√©cnica</h2>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
        <div>
          <strong>Modo Astro:</strong>
          {import.meta.env.MODE}
        </div>
        <div>
          <strong>Producci√≥n:</strong>
          {import.meta.env.PROD ? 'S√≠' : 'No'}
        </div>
        <div>
          <strong>Desarrollo:</strong>
          {import.meta.env.DEV ? 'S√≠' : 'No'}
        </div>
        <div>
          <strong>Timestamp:</strong>
          {serverStatus.timestamp}
        </div>
      </div>
    </section>

    <!-- INSTRUCCIONES -->
    <section class="p-6 bg-yellow-50 rounded-lg border-l-4 border-yellow-400">
      <h2 class="text-xl font-semibold mb-4">
        üí° C√≥mo usar las variables de entorno
      </h2>
      <div class="space-y-4 text-sm">
        <div>
          <strong>Variables P√∫blicas (CLIENT):</strong>
          <pre
            class="bg-gray-100 p-2 rounded mt-2 overflow-x-auto"><code>{'import { PUBLIC_SITE_TITLE } from \'astro:env/client\';'}</code></pre>
          <p class="mt-1 text-gray-600">
            Disponibles en cliente y servidor. Visibles en DevTools.
          </p>
        </div>

        <div>
          <strong>Variables Secretas (SERVER):</strong>
          <pre
            class="bg-gray-100 p-2 rounded mt-2 overflow-x-auto"><code>{'import { WEBHOOK_URL, ANALYTICS_API_KEY } from \'astro:env/server\';'}</code></pre>
          <p class="mt-1 text-gray-600">
            Solo en servidor. No se incluyen en el bundle del cliente.
          </p>
        </div>

        <div>
          <strong>Configuraci√≥n:</strong>
          <p class="mt-1 text-gray-600">
            Las variables se definen en <code>astro.config.mjs</code> con tipos seguros.
            Valores reales en <code>.env</code> (no subir a Git).
          </p>
        </div>
      </div>
    </section>
  </main>

  <!-- SCRIPT DEL CLIENTE PARA DEMOSTRAR VARIABLES P√öBLICAS -->
  <script>
    // Las variables p√∫blicas tambi√©n est√°n disponibles en scripts del cliente
    import { PUBLIC_DEBUG_MODE, PUBLIC_SITE_TITLE } from 'astro:env/client';

    console.log('üåê Variables de entorno en el cliente:');
    console.log('- T√≠tulo del sitio:', PUBLIC_SITE_TITLE);
    console.log('- Debug mode:', PUBLIC_DEBUG_MODE);

    // Ejemplo de uso condicional basado en variables de entorno
    if (PUBLIC_DEBUG_MODE) {
      console.log(
        'üîß Modo debug habilitado - Informaci√≥n adicional disponible',
      );

      // Crear indicador visual de debug mode
      const debugIndicator = document.createElement('div');
      debugIndicator.innerHTML = 'üîß DEBUG MODE';
      debugIndicator.style.cssText = `
        position: fixed;
        top: 10px;
        right: 10px;
        background: orange;
        color: white;
        padding: 5px 10px;
        border-radius: 5px;
        font-size: 12px;
        z-index: 1000;
        font-weight: bold;
      `;
      document.body.appendChild(debugIndicator);
    }
  </script>

  <style>
    code {
      font-family: 'Courier New', monospace;
    }

    pre {
      white-space: pre-wrap;
      word-wrap: break-word;
    }
  </style>
</Layout>
