---
import { ProjectCard } from '@components';
import { useTranslations, type Locale, translations } from '@utils/i18n';
import * as assets from '@assets';

// Recibir locale como prop en lugar de detectarlo
interface Props {
  locale?: Locale;
}

const { locale = 'es' } = Astro.props;
const t = useTranslations(locale);

// Tipo para las claves de proyectos
type ProjectKey = 'yuvod' | 'nextival' | 'stelcamping' | 'bnc10' | 'tookane';

// Tipo para los proyectos combinados
type Project = {
  title: string;
  stack: string;
  description: string;
  impact: string;
  featured: boolean;
  liveUrl?: string | undefined;
  githubUrl?: string | undefined;
  image: any;
};

// Configuración de proyectos con URLs e imágenes
const projectsConfig: Array<{
  key: ProjectKey;
  featured: boolean;
  liveUrl?: string;
  githubUrl?: string;
  image: any;
}> = [
  {
    key: 'yuvod',
    featured: true,
    liveUrl: 'https://yuvod.com',
    image: assets.yuvodLogo,
  },
  {
    key: 'nextival',
    featured: false,
    githubUrl: 'https://github.com/ImSoulRebel/nextival-cms',
    image: assets.nextivalLogo,
  },
  {
    key: 'stelcamping',
    featured: false,
    liveUrl: 'https://stel.es',
    image: assets.stelLogo,
  },
  {
    key: 'bnc10',
    featured: false,
    image: assets.bnc10Logo,
  },
  {
    key: 'tookane',
    featured: false,
    liveUrl: 'https://tookane.com',
    image: assets.tookaneLogo,
  },
];

// Construir proyectos desde traducciones + configuración
const projects: Project[] = projectsConfig.map((config) => {
  const projectData = translations[locale as Locale].projects.list[config.key];
  if (!projectData) {
    throw new Error(`Missing project data for key: ${config.key}`);
  }
  return {
    title: projectData.title,
    stack: projectData.stack,
    description: projectData.description,
    impact: projectData.impact,
    featured: config.featured,
    liveUrl: config.liveUrl,
    githubUrl: config.githubUrl,
    image: config.image,
  };
});
---

<section id="projects" class="projects">
  <div class="container">
    <h2 class="section-title">{t('projects.title')}</h2>
    <div class="projects-grid">
      {
        projects.map((project: Project) => (
          <ProjectCard
            title={project.title}
            stack={project.stack}
            description={project.description}
            impact={project.impact}
            featured={project.featured}
            liveUrl={project.liveUrl}
            githubUrl={project.githubUrl}
            image={project.image}
            locale={locale}
          />
        ))
      }
    </div>
  </div>
</section>
