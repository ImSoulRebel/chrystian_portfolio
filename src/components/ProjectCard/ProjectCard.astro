---
import { useTranslations, type Locale } from '@utils/i18n';
import { SvgComponent } from 'astro/types';
import styles from './projectCard.module.css';

interface Props {
  id: string;
  title: string | undefined;
  stack: string | string[] | undefined;
  description: string | undefined;
  impact?: string | undefined;
  image?: (SvgComponent & ImageMetadata) | undefined;
  liveUrl?: string | undefined;
  githubUrl?: string | undefined;
  featured?: boolean;
  locale?: Locale;
  nda?: boolean;
  sector?: string | undefined;
  role?: string | undefined;
  duration?: string | undefined;
  team?: string | undefined;
  metrics?: Array<{ label: string; value: string }> | undefined;
}

const {
  id,
  title,
  stack,
  description,
  impact,
  liveUrl,
  featured = false,
  locale = 'es',
  nda = false,
  sector,
  role,
  duration,
  team,
  metrics,
} = Astro.props;

const t = useTranslations(locale);
// Convert stack string to array for better display
const techStack = typeof stack === 'string' ? stack.split(' ¬∑ ') : stack || [];
---

<a href={`/${locale}/projects/${id}`} class={styles.cardLink}>
  <article
    class={`${styles.projectCard} ${featured ? styles.featured : ''} ${nda ? styles.nda : ''}`}
  >
    <div class={styles.projectContent}>
      <div class={styles.projectHeader}>
        <h3 class={styles.projectTitle}>{title}</h3>

        {/* Project Metadata */}
        {
          (sector || role || duration || team) && (
            <div class={styles.projectMeta}>
              {sector && (
                <div class={styles.metaItem}>
                  <span class={styles.metaLabel}>
                    {t('projects.metadata.sector')}:
                  </span>
                  <span class={styles.metaValue}>{sector}</span>
                </div>
              )}
              {role && (
                <div class={styles.metaItem}>
                  <span class={styles.metaLabel}>
                    {t('projects.metadata.role')}:
                  </span>
                  <span class={styles.metaValue}>{role}</span>
                </div>
              )}
            </div>
          )
        }

        {/* Impact Subtitle */}
        {impact && <p class={styles.projectSubtitle}>{impact}</p>}
      </div>

      <p class={styles.projectDescription}>
        {description}
      </p>
      <span class={styles.readMore}>
        {t('projects.readMore') || 'Leer m√°s'}
        <svg
          width="14"
          height="14"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
        >
          <path
            d="M5 12h14M12 5l7 7-7 7"
            stroke-linecap="round"
            stroke-linejoin="round"></path>
        </svg>
      </span>

      {/* Highlighted Metrics */}
      {
        metrics && metrics.length > 0 && (
          <div class={styles.metricsHighlight}>
            {metrics
              .slice(0, 2)
              .map((metric: { label: string; value: string }) => (
                <div class={styles.metricItem}>
                  <span class={styles.metricValue}>{metric.value}</span>
                  <span class={styles.metricLabel}>{metric.label}</span>
                </div>
              ))}
          </div>
        )
      }

      <div class={styles.techStack}>
        {
          techStack
            .slice(0, 8)
            .map((tech: string) => (
              <span class={styles.techTag}>{tech.trim()}</span>
            ))
        }
        {
          techStack.length > 8 && (
            <span class={styles.techTag}>+{techStack.length - 8}</span>
          )
        }
      </div>

      {
        (liveUrl || featured || nda) && (
          <div class={styles.projectStats}>
            {nda && (
              <div class={styles.statItem}>
                <span class={styles.statIcon}>
                  <svg
                    width="14"
                    height="14"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path
                      d="M12 2C10.3431 2 9 3.34315 9 5V8H7C5.89543 8 5 8.89543 5 10V20C5 21.1046 5.89543 22 7 22H17C18.1046 22 19 21.1046 19 20V10C19 8.89543 18.1046 8 17 8H15V5C15 3.34315 13.6569 2 12 2Z"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    />
                    <circle cx="12" cy="15" r="2" fill="currentColor" />
                  </svg>
                </span>
                <span>{t('projects.badges.nda')}</span>
              </div>
            )}
            {liveUrl && (
              <div class={styles.statItem}>
                <span class={styles.statIcon}>üåê</span>
                <span>{t('projects.stats.inProduction')}</span>
              </div>
            )}
            {featured && (
              <div class={styles.statItem}>
                <span class={styles.statIcon}>‚≠ê</span>
                <span>{t('projects.stats.featuredProject')}</span>
              </div>
            )}
          </div>
        )
      }
    </div>
  </article>
</a>
