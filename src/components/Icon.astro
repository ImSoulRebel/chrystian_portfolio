---
import { Image } from 'astro:assets';
import * as assets from '../assets';

const { name, size = 24, color, class: className = '' } = Astro.props;

// Mapeo de variables CSS a sus valores hexadecimales para los filtros
const cssVariableToHex: Record<string, string> = {
  'var(--primary-color)': '#00d4ff',
  'var(--secondary-color)': '#1a1a2e',
  'var(--accent-color)': '#16213e',
  'var(--text-primary)': '#ffffff',
  'var(--text-secondary)': '#b8c4d6',
  'var(--text-muted)': '#7a8ca8',
  'var(--background-dark)': '#0f0f23',
  'var(--background-card)': '#1a1a2e',
};

// Función para convertir color hex a filtro CSS
const hexToFilter = (hex: string) => {
  // Algunos colores comunes y sus filtros CSS equivalentes
  const colorFilters: Record<string, string> = {
    '#ffffff': 'brightness(0) saturate(100%) invert(100%)',
    '#000000': 'brightness(0) saturate(100%)',
    '#ff0000':
      'brightness(0) saturate(100%) invert(18%) sepia(100%) saturate(7500%) hue-rotate(0deg)',
    '#00ff00':
      'brightness(0) saturate(100%) invert(50%) sepia(100%) saturate(2000%) hue-rotate(90deg)',
    '#0000ff':
      'brightness(0) saturate(100%) invert(18%) sepia(100%) saturate(7500%) hue-rotate(240deg)',
    '#00d4ff':
      'brightness(0) saturate(100%) invert(58%) sepia(100%) saturate(1000%) hue-rotate(180deg)',
    '#ffd93d':
      'brightness(0) saturate(100%) invert(85%) sepia(100%) saturate(1000%) hue-rotate(40deg)',
    '#ff6b6b':
      'brightness(0) saturate(100%) invert(58%) sepia(100%) saturate(1000%) hue-rotate(340deg)',
    '#4ecdc4':
      'brightness(0) saturate(100%) invert(70%) sepia(100%) saturate(1000%) hue-rotate(160deg)',
    '#1a1a2e':
      'brightness(0) saturate(100%) invert(15%) sepia(25%) saturate(500%) hue-rotate(200deg)',
    '#16213e':
      'brightness(0) saturate(100%) invert(20%) sepia(30%) saturate(600%) hue-rotate(220deg)',
    '#b8c4d6':
      'brightness(0) saturate(100%) invert(75%) sepia(10%) saturate(200%) hue-rotate(200deg)',
    '#7a8ca8':
      'brightness(0) saturate(100%) invert(55%) sepia(15%) saturate(300%) hue-rotate(200deg)',
    '#0f0f23':
      'brightness(0) saturate(100%) invert(10%) sepia(20%) saturate(400%) hue-rotate(240deg)',
  };

  // Si el color está en nuestro mapa, usar el filtro específico
  if (colorFilters[hex.toLowerCase()]) {
    return colorFilters[hex.toLowerCase()];
  }

  // Para otros colores, intentar una aproximación básica
  return `brightness(0) saturate(100%) invert(50%) sepia(100%) saturate(1000%) hue-rotate(0deg)`;
};

// Función para procesar el color (variable CSS o hex)
const processColor = (inputColor?: string) => {
  if (!inputColor) return '';

  // Si es una variable CSS, convertir a hex para el filtro
  if (inputColor.startsWith('var(--')) {
    const hexValue = cssVariableToHex[inputColor];
    return hexValue ? hexToFilter(hexValue) : '';
  }

  // Si es un color hex directo
  return hexToFilter(inputColor);
};

// Mapping de iconos disponibles en la carpeta logos
const iconMap: Record<string, any> = {
  architecture: assets.architectureLogo,
  astro: assets.astroLogo,
  aws: assets.awsLogo,
  bloc: assets.blocLogo,
  bnc10: assets.bnc10Logo,
  cicd: assets.cicdLogo,
  dart: assets.dartLogo,
  docker: assets.dockerLogo,
  firebase: assets.firebaseLogo,
  flutter: assets.flutterLogo,
  git: assets.gitLogo,
  github: assets.githubIcon,
  javascript: assets.javascriptLogo,
  linkedin: assets.linkedinIcon,
  nextival: assets.nextivalLogo,
  nodejs: assets.nodejsLogo,
  optimus: assets.optimusLogo,
  react: assets.reactLogo,
  solidjs: assets.solidjsLogo,
  stel: assets.stelLogo,
  tookane: assets.tookaneLogo,
  typescript: assets.typescriptLogo,
  websockets: assets.websocketLogo,
  yuvod: assets.yuvodLogo,
};

// Iconos por defecto para tecnologías
const defaultIcons = {
  email: `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <rect x="2" y="4" width="20" height="16" rx="2" stroke="${color || 'currentColor'}" stroke-width="2" fill="none"/>
    <path d="M22 6L12 13L2 6" stroke="${color || 'currentColor'}" stroke-width="2"/>
  </svg>`,
  phone: `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M22 16.92V19.92C22 20.52 21.52 21 20.92 21C10.39 21 2 12.61 2 2.08C2 1.48 2.48 1 3.08 1H6.08C6.68 1 7.16 1.48 7.16 2.08C7.16 3.58 7.45 5.03 7.99 6.36C8.18 6.84 8.01 7.4 7.59 7.7L5.79 9.01C7.24 12.4 10.6 15.76 13.99 17.21L15.3 15.41C15.6 14.99 16.16 14.82 16.64 15.01C17.97 15.55 19.42 15.84 20.92 15.84C21.52 15.84 22 16.32 22 16.92Z" fill="${color || 'currentColor'}"/>
  </svg>`,
  mobile: `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <rect x="5" y="2" width="14" height="20" rx="2" ry="2" stroke="${color || 'currentColor'}" stroke-width="2" fill="none"/>
    <line x1="12" y1="18" x2="12" y2="18" stroke="${color || 'currentColor'}" stroke-width="2" stroke-linecap="round"/>
  </svg>`,
  trophy: `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M6 9V3C6 2.45 6.45 2 7 2H17C17.55 2 18 2.45 18 3V9" stroke="${color || 'currentColor'}" stroke-width="2" fill="none"/>
    <path d="M6 9C4.34 9 3 10.34 3 12C3 13.66 4.34 15 6 15H7C7.55 15 8 14.55 8 14V11C8 10.45 7.55 10 7 10H6V9Z" fill="${color || '#FFD700'}"/>
    <path d="M18 9C19.66 9 21 10.34 21 12C21 13.66 19.66 15 18 15H17C16.45 15 16 14.55 16 14V11C16 10.45 16.45 10 17 10H18V9Z" fill="${color || '#FFD700'}"/>
    <rect x="8" y="15" width="8" height="2" fill="${color || '#FFD700'}"/>
    <rect x="10" y="17" width="4" height="5" fill="#8B4513"/>
  </svg>`,
  code: `<svg width="${size}" height="${size}" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M8 6L2 12L8 18" stroke="${color || 'currentColor'}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M16 6L22 12L16 18" stroke="${color || 'currentColor'}" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>`,
};

const iconSrc = iconMap[name?.toLowerCase() as keyof typeof iconMap];
---

{
  iconSrc ? (
    <Image
      src={iconSrc}
      alt={name}
      width={size}
      height={size}
      class={className}
      loading="lazy"
      style={color ? `filter: ${processColor(color)};` : ''}
    />
  ) : (
    <div
      class={`inline-flex items-center justify-center ${className}`}
      style={color ? `color: ${color};` : ''}
      set:html={
        defaultIcons[name?.toLowerCase() as keyof typeof defaultIcons] ||
        `<div style="width: ${size}px; height: ${size}px; background: ${color || 'currentColor'}; border-radius: 4px;"></div>`
      }
    />
  )
}

<style>
  img {
    display: inline-block;
    vertical-align: middle;
  }
</style>
